services:
  orchestrator:
    image: ghcr.io/adcl-io/adcl-community/orchestrator:latest
    container_name: adcl-orchestrator
    ports:
      - "${ORCHESTRATOR_PORT:-8000}:8000"
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ADCL_EDITION=community
      - AUTO_INSTALL_MCPS=agent,file-tools,nmap-recon
      - AGENT_PORT=7000
      - FILE_TOOLS_PORT=7002
      - NMAP_PORT=7003
      - PYTHONUNBUFFERED=1
    volumes:
      - ./workspace:/app/workspace
      - ./logs:/app/logs
      - ./agent-definitions:/app/agent-definitions
      - ./agent-teams:/app/agent-teams
      - ./workflows:/app/workflows
      - ./mcp_servers:/app/mcp_servers:ro
      - ./registry:/app/registry:ro
      - /var/run/docker.sock:/var/run/docker.sock
    user: root
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - adcl-network
    depends_on:
      - registry
    restart: unless-stopped

  frontend:
    image: ghcr.io/adcl-io/adcl-community/frontend:latest
    container_name: adcl-frontend
    ports:
      - "${FRONTEND_PORT:-3000}:3000"
    environment:
      - VITE_API_URL=http://localhost:${ORCHESTRATOR_PORT:-8000}
    depends_on:
      - orchestrator
    networks:
      - adcl-network
    restart: unless-stopped

  registry:
    image: ghcr.io/adcl-io/adcl-community/registry:latest
    container_name: adcl-registry
    ports:
      - "${REGISTRY_PORT:-9000}:9000"
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      - ./registry:/app/registry:ro
    networks:
      - adcl-network
    restart: unless-stopped

networks:
  adcl-network:
    driver: bridge
